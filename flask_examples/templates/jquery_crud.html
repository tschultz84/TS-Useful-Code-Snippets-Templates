<!-- templates/jquery_crud.html -->
<!-- This is an example of a Python Flask / JS application which can create, read, update, and edit entries in tabular data format
    It does all its reading and writing from a tabular CSV file containing a list of recipes; I did this to include in this template
    the simplest possible tabular data read-in. 

    I leave it to the user to translate this to SQL or whatever other tabular data format you actually use in your application. 
    .-->

<!DOCTYPE html>

{% extends "base.html" %}
{% block content %}

    <h1>Basic Create, Read, Update, Edit, Application in Flask / JavaScript</h1>
    <p>Built using JQuery</p>
    <p>Output string: {{ python_data['output_string'] }}</p>
    <p>JSON output is as follows: {{ python_data['json_out']|tojson|safe }}</p>

    <!-- TABLE CONSTRUCTION-->
    <table id='table'>
        <!-- HEADING FORMATION -->
        <tr>
            <th>Record ID</th>
            <th>Recipe Title</th>
            <th>Description</th>
            <th>Author</th>
            <th>Category</th>
            <th>Cuisine</th>
            <th>Serving Size</th>
            <th>Cook Time</th>
            <th>Prep Time</th>
            <th>Notes</th>
            <th>Tags</th>
            <th>Ingredients</th>
            <th>Directions</th>
            
        </tr>

    </table>
        

    <script type="text/javascript">
        
        // Execute this once the document is fully loaded.
        $(document).ready(function () {
  
            window.console && console.log('Launching table build.')

            // PARSING DATA FROM JSON 
            var jsondata = JSON.parse( {{ python_data['json_out']|tojson|safe }} );

            window.console && console.log( 'I used JSON.parse to load data, which looks like: ' + JSON.stringify(jsondata) );

            var columncount = 0 ;
            var itemlength = -1;
            var arraydims = Array();

            // This code documents the shape of your array. 
            $.each(jsondata ,function(key, value){

                // Looping over each column, increment.
                columncount += 1;

                // Reset the counter for the number of rows.
                itemlength = 0;

                // Now count over every value. 
                $.each(value , function(){
                    itemlength += 1;
                });

                // Add the row length to the shape array. 
                arraydims.push(itemlength);
            });

            window.console && console.log( 'It has ' + columncount + ' columns.' );
            window.console && console.log( 'The last column had ' + itemlength + ' entries.' );
            window.console && console.log( 'The dimensions are ' + arraydims.toString() );

            //var tabledata = jQuery.makeArray(jsondata);

            //window.console && console.log( 'I transformed it into an array, which looks like: ' + tabledata.toString() );
            
            // ITERATING THROUGH OBJECTS
            // TODO: This does not yet correctly loop throuhg objects - it loops over each column, not each row. 
            var recipe_row_string = '';
            var length_test = -1
            var counter = 0;

            // This flag is set to FALSE if there is any fatal error requiring a halt to the table build.
            var continuer = true;
            
            // This executes the loop function.
            $.each(jsondata, function (key, rowdata) {
                
                

                if (continuer == true){
                    //INSERTING ROWS INTO TABLE 
                    window.console && console.log('Adding ' + recipe_row_string + ' to table.');
                    $('#table').append(recipe_row_string);
                    
                    } else {
                        $('#table').remove;
                        window.console && console.log('Table removed due to mismatch in column lengths. Check your table import is correctly formatted.');
                        return false;
                    }
                counter= counter+1
                
            });
                
        });
             
                
        
                        
                   

    </script>

{% endblock %}

</html>